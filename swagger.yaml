openapi: 3.1.0
info:
  title: MMA Gym API
  description: Complete API for managing MMA gym operations including classes, bookings, shop, and user management
  version: 1.0.0
  contact:
    name: Apex MMA
    email: dev@apexmma.com

servers:
  - url: http://localhost:3001/api
    description: Development server
  - url: http://localhost:3001
    description: Development root
  - url: https://api.apexmma.com
    description: Production server

tags:
  - name: Content
    description: CMS content management
  - name: Classes
    description: Class schedules and templates
  - name: Coaches
    description: Coach profiles and availability
  - name: Auth
    description: Authentication and authorization
  - name: Shop
    description: E-commerce operations
  - name: User
    description: User profile and account management
  - name: Bookings
    description: Class and session bookings
  - name: Membership Plans
    description: Membership plan management
  - name: Private Sessions
    description: Personal training sessions
  - name: Webhooks
    description: External service webhooks
  - name: Health
    description: Service health checks

paths:
  /content/{key}:
    get:
      tags: [Content]
      summary: Get content block by key
      parameters:
        - in: path
          name: key
          required: true
          schema:
            type: string
          example: "home.hero"
        - in: query
          name: locale
          schema:
            type: string
            default: en
      responses:
        '200':
          description: Content block retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /classes/disciplines:
    get:
      tags: [Classes]
      summary: List all martial arts disciplines
      responses:
        '200':
          description: List of disciplines
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassDiscipline'

  /classes/templates:
    get:
      tags: [Classes]
      summary: List class templates with filters
      parameters:
        - in: query
          name: discipline
          schema:
            type: string
        - in: query
          name: level
          schema:
            type: string
        - in: query
          name: coachId
          schema:
            type: string
      responses:
        '200':
          description: List of class templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassTemplate'

  /classes/templates/{id}:
    get:
      tags: [Classes]
      summary: Get class template by ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Class template details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ClassTemplate'
        '404':
          description: Class template not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string

  /classes/sessions:
    get:
      tags: [Classes]
      summary: List class sessions with filters
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: discipline
          schema:
            type: string
        - in: query
          name: coachId
          schema:
            type: string
      responses:
        '200':
          description: List of class sessions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassSession'

  /coaches:
    get:
      tags: [Coaches]
      summary: List all active coaches
      parameters:
        - in: query
          name: specialty
          schema:
            type: string
      responses:
        '200':
          description: List of coaches
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Coach'

  /auth/login:
    post:
      tags: [Auth]
      summary: User authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 6
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                      user:
                        $ref: '#/components/schemas/User'
  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, name]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                name:
                  type: string
                phone:
                  type: string
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /coaches/{id}:
    get:
      tags: [Coaches]
      summary: Get coach by ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Coach details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Coach'
        '404':
          description: Coach not found

  /coaches/{id}/availability:
    get:
      tags: [Coaches]
      summary: Get coach availability
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Available time slots
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Coach not found

  /bookings:
    post:
      tags: [Bookings]
      summary: Create a booking
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId, sessionId]
              properties:
                userId:
                  type: string
                sessionId:
                  type: string
      responses:
        '201':
          description: Booking created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /bookings/{id}:
    delete:
      tags: [Bookings]
      summary: Cancel a booking
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Booking cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Booking not found

  /membership-plans:
    get:
      tags: [Membership Plans]
      summary: List membership plans
      responses:
        '200':
          description: List of plans
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    post:
      tags: [Membership Plans]
      summary: Create a membership plan
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Plan created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /membership-plans/{id}:
    get:
      tags: [Membership Plans]
      summary: Get membership plan
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Plan details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Plan not found
    put:
      tags: [Membership Plans]
      summary: Update membership plan
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Plan updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Plan not found
    delete:
      tags: [Membership Plans]
      summary: Delete membership plan
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Plan deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Plan not found

  /private-sessions:
    post:
      tags: [Private Sessions]
      summary: Book a private session
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId, coachId, startAt, endAt]
              properties:
                userId:
                  type: string
                coachId:
                  type: string
                startAt:
                  type: string
                  format: date-time
                endAt:
                  type: string
                  format: date-time
                notes:
                  type: string
      responses:
        '201':
          description: Private session booked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /private-sessions/{id}/cancel:
    post:
      tags: [Private Sessions]
      summary: Cancel a private session
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Session cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Session not found

  /shop/categories:
    get:
      tags: [Shop]
      summary: List product categories
      responses:
        '200':
          description: Category list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /shop/products:
    get:
      tags: [Shop]
      summary: List products with filters
      parameters:
        - in: query
          name: query
          schema:
            type: string
        - in: query
          name: categoryId
          schema:
            type: string
        - in: query
          name: inStock
          schema:
            type: boolean
        - in: query
          name: sort
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
      responses:
        '200':
          description: Product list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /shop/products/{id}:
    get:
      tags: [Shop]
      summary: Get product by ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Product not found

  /shop/cart:
    post:
      tags: [Shop]
      summary: Calculate cart totals
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Cart calculated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /shop/whatsapp-config:
    get:
      tags: [Shop]
      summary: Get WhatsApp order configuration
      responses:
        '200':
          description: Configuration data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /me:
    get:
      tags: [User]
      summary: Get current user profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /me/bookings:
    get:
      tags: [User]
      summary: Get current user's bookings
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Booking list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /me/orders:
    get:
      tags: [User]
      summary: Get current user's orders
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Order list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /webhooks/stripe:
    post:
      tags: [Webhooks]
      summary: Handle Stripe webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook received

  /health:
    get:
      tags: [Health]
      summary: Health check
      responses:
        '200':
          description: Service status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

components:
  schemas:
    ApiResponse:
      type: object
      properties:
        data:
          oneOf:
            - type: object
            - type: array
        meta:
          type: object
          properties:
            page:
              type: integer
            limit:
              type: integer
            total:
              type: integer
            totalPages:
              type: integer

    ClassDiscipline:
      type: object
      required: [id, name, slug]
      properties:
        id:
          type: string
        slug:
          type: string
        name:
          type: string
        description:
          type: string
        tags:
          type: array
          items:
            type: string
        media:
          type: array
          items:
            $ref: '#/components/schemas/MediaItem'

    ClassTemplate:
      type: object
      required: [id, disciplineId, title, level, durationMin, description]
      properties:
        id:
          type: string
        disciplineId:
          type: string
        title:
          type: string
        level:
          type: string
          enum: [beginner, intermediate, advanced, all_levels]
        durationMin:
          type: integer
        description:
          type: string
        gearNeeded:
          type: array
          items:
            type: string
        coachIds:
          type: array
          items:
            type: string
        price:
          type: number
        prerequisites:
          type: array
          items:
            type: string

    ClassSession:
      type: object
      required: [id, templateId, coachId, startAt, endAt]
      properties:
        id:
          type: string
        templateId:
          type: string
        coachId:
          type: string
        locationId:
          type: string
        room:
          type: string
        startAt:
          type: string
          format: date-time
        endAt:
          type: string
          format: date-time
        capacity:
          type: integer
          minimum: 1
        bookedCount:
          type: integer
          minimum: 0
        waitlist:
          type: array
          items:
            type: string
        status:
          type: string
          enum: [scheduled, cancelled, full, in_progress, completed]

    Coach:
      type: object
      required: [id, name]
      properties:
        id:
          type: string
        name:
          type: string
        bio:
          type: string
        accolades:
          type: array
          items:
            type: string
        socials:
          type: array
          items:
            $ref: '#/components/schemas/SocialLink'
        photo:
          type: string
          format: uri
        specialties:
          type: array
          items:
            type: string
        hourlyRate:
          type: number
          minimum: 0
        isActive:
          type: boolean

    User:
      type: object
      required: [id, email, name]
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        name:
          type: string
        phone:
          type: string
        roles:
          type: array
          items:
            type: string
            enum: [guest, member, coach, admin]
        credits:
          type: integer
          minimum: 0

    MediaItem:
      type: object
      required: [type, src]
      properties:
        type:
          type: string
          enum: [image, video]
        src:
          type: string
          format: uri
        alt:
          type: string
        caption:
          type: string

    SocialLink:
      type: object
      required: [platform, url]
      properties:
        platform:
          type: string
        url:
          type: string
          format: uri

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []